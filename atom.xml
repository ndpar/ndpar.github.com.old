<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Side Notes]]></title>
  <link href="http://blog.ndpar.com/atom.xml" rel="self"/>
  <link href="http://blog.ndpar.com/"/>
  <updated>2013-05-25T18:55:44-04:00</updated>
  <id>http://blog.ndpar.com/</id>
  <author>
    <name><![CDATA[Andrey Paramonov]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Joe Armstrong at MostlyErlang]]></title>
    <link href="http://blog.ndpar.com/2013/05/21/joe-armstrong-mostlyerlang/"/>
    <updated>2013-05-21T15:13:01-04:00</updated>
    <id>http://blog.ndpar.com/2013/05/21/joe-armstrong-mostlyerlang</id>
    <content type="html"><![CDATA[<p>The main guest at today&rsquo;s <a href="http://mostlyerlang.wordpress.com/2013/05/21/43/">MostlyErlang</a> podcast is Joe Armstrong, the co-inventor of Erlang, a wise man, and a brilliant speaker. I listened to the podcast few times, and every time enjoyed it. I highly recommend it to all programmers regardless whether they are using Erlang or not.</p>

<p>While we are waiting for the oficial transcript, this post provides some highlights. I put here the quotes I found particularly interesting or funny.</p>

<h2>Concurrency</h2>

<blockquote><p>I&rsquo;ve got a blog on my GitHub, and I thouhgt I&rsquo;d put two different types of articles there and see what the response is. One theme I&rsquo;m pursuing is &ldquo;explaining to 5-year-old&rdquo; theme, and the other is &ldquo;technically complicated&rdquo; theme.</p></blockquote>

<p>Then he describes the &ldquo;<a href="http://joearms.github.io/2013/04/05/concurrent-and-parallel-programming.html">concurrency vs parallelism</a>&rdquo; picture for 5 y.o.</p>

<blockquote><p>That blog entry got 25,000 people read it, and they got 10 responses and quite a lot of criticism actually from people who know what concurrency and parallelism is. And then I compare it to some other articles I&rsquo;ve written that technically deeper. There you got only few hundred people read it.</p></blockquote>

<p>I noticed it too. All those people, who responded with <a href="http://www.yosefk.com/blog/parallelism-and-concurrency-need-different-tools.html">long blogs</a> about concurrency, missed the point: This picture was for kids, and for kids it&rsquo;s a pretty good picture. Adults should go and read the technical papers, but they didn&rsquo;t.</p>

<!-- more -->


<h2>Let it crash</h2>

<blockquote><p>Once upon a time we had a Leadership Election algorithm in Erlang. We got some theoreticians involved, and they proved the algorithm to be correct. It&rsquo;s been in practice for some time when we sent them a bug report, which showed that the thing elected two leaders, and we can reproduce it. And then they looked at this bug and went back at the code, and said the code is correct, but we had to make certain assumptions that this failure couldn&rsquo;t happen.</p></blockquote>

<p>I like it. We should always keep it in mind: Before you prove anything, make sure, your assumptions are valid.</p>

<h2>Favourite bad idea</h2>

<blockquote><p>The first bad idea we put in Erlang is the process priorities. I don&rsquo;t think it&rsquo;s documented anywhere. It&rsquo;s definitely not in my book. It&rsquo;s not supposed to be documented — that&rsquo;s deliberate.</p></blockquote>

<p><a href="http://www.erlangprogramming.org/">Erlang Programming</a> mentions the process priorities on page 113, but they wrote the whole paragraph explaining why it&rsquo;s a bad idea.</p>

<blockquote><p>I was forced into position where I had to put them in [the language]. So I waited a few weeks and I put in an Erlang code that sets process priorities some integer, and this code didn&rsquo;t do anything at all. It was commented out. I shipped the system, and then I asked &ldquo;How do you like it with priorities?&rdquo; And they said &ldquo;Now it&rsquo;s much better!&rdquo;</p></blockquote>

<p>Brilliant! Although, it pisses them off when people eventually find what&rsquo;s going on in the code.</p>

<h2>Performance</h2>

<blockquote><p>One thing I like about Erlang is it&rsquo;s got pretty predictible performance model.</p>

<p>There was some guy on the mailing list that said &ldquo;I wrote a code that finds line breaks in the large file, and the result surprised me. I expected it to take this long, and it took a heck of a lot longer.&rdquo; I wrote a little benchmark and I couldn&rsquo;t see that effect. I mailed back &ldquo;mine didn&rsquo;t behave like that.&rdquo; Then he said &ldquo;There is another funny thing: the distribution of my file is not uniformed. I&rsquo;ve got extremly long lines in it, and the rest are the same.&rdquo; And from then it took Patrik five minutes to find a bug in the system. But if he hadn&rsquo;t made an observation &ldquo;this thing surprises me&rdquo; and didn&rsquo;t give this clue that it happened under these circumstances, that bug could be in the system for years. But people find performance thing and they don&rsquo;t tell us the fact they are surprised, so we can&rsquo;t debug it.</p></blockquote>

<p>Lesson learned: If you <a href="http://code.mixpanel.com/2011/08/05/how-and-why-we-switched-from-erlang-to-python/">don&rsquo;t like</a> the performance of your Erlang code, don&rsquo;t be shy to speak up about it. Either you are doing something wrong or there is a bug in Erlang. Both things are fixable.</p>

<h2>Scalability</h2>

<blockquote><p><a href="http://www.ericsson.com/ourportfolio/products/sgsn-mme">MME</a> is a thing in the backbone of mobile telephony network, it makes all mobile data work. And it&rsquo;s written in Erlang. Smartphones wouldn&rsquo;t be able to connect to the network at all without MME. Now, Ericsson&rsquo;s got the biggest market share in the world for mobile base stations, for we do 40% of the total world market of 3G and CDMA and 60% of the world market for LTE and 4G. This gives us about 50% of the world market. That means Erlang&rsquo;s controlling 50% of all smartphones world wide.</p></blockquote>

<p>That&rsquo;s impressive, and at the same time it&rsquo;s sad because people don&rsquo;t know about it. People are talking about Twitter scale, Google scale, or other sorts of &ldquo;web-scale&rdquo;, but they don&rsquo;t realize that most of the data Twitter and Google receive nowadays is comming through mobile network, which means most of Twitter and Google data is coming throug Erlang. Think about it.</p>

<p>On the other hand, those who see the power of Erlang get big competitive advantage.</p>

<blockquote><p>At Erlang user conference somebody from gaming company came to me and said &ldquo;Erlang&rsquo;s great! We have it on our server, and we managed to get 3 million connections on it!&rdquo; And he was overjoyed. It&rsquo;s fantastic. I said &ldquo;Great! You got to tell everybody…&rdquo; And he said &ldquo;No, no.&rdquo; — &ldquo;Why not?&rdquo; — &ldquo;Because we tell our competitiors we use Jigsaw.&rdquo;</p>

<p>There is no commercial advantage from using Ruby on Rails or Java or anything else. You might go to the conferences and swap battle stories and swap tips. But if you actually found something which is bloody better, you are not going to tell anybody, are you?</p></blockquote>

<p>Hm, maybe that&rsquo;s why I cannot find any software company in Toronto that&rsquo;s doing Erlang. Hey Toronto programmers, if you are programming in Erlang, please let me know — I won&rsquo;t tell your competitors, I promise.</p>

<h2>Broken software</h2>

<blockquote><p>Most of my time as a programmer is spent fixing broken stuff that shouldn&rsquo;t be broken. Whenever I&rsquo;m trying to do something, it doesn&rsquo;t work. I used to spend more than 50% of my time fixing trivial things, and the percentage of my time is increasing by year. If I look back 20 years ago, I din&rsquo;t spend 50% of my time fixing broken software. The software that was available was a lot lot simpler, and it was written by engineers and teams and by small group of people, and it didn&rsquo;t have errors in it. If we extrapolate this in 20 years time, it&rsquo;s going to be even more software, and 90% of it will be completely broken, unless we find better ways of structuring it and gluing things together.</p></blockquote>

<p>So true. I have the same statistics. One third of my time I&rsquo;m shaving software yaks, and another third I&rsquo;m debugging protocols trying to figure out why my code is not working with another code.</p>

<h2>Conference driven development</h2>

<blockquote><p>I&rsquo;m giving a keynote at LambdaJam. I&rsquo;ve written a <a href="http://lambdajam.com/sessions#armstrong">flushing title</a> but I haven&rsquo;t written the talk yet.</p></blockquote>

<p>Lesson learned: Next time you want to give a talk at a conference, come up with a catchy title, and think about the talk itself later.</p>

<blockquote><p>I deliberately give myself titles for stuff I know nothing about, and I implement it all. You know, Robert did that for Lua. You know why Lua got developed in Erlang? Robert was going to give a talk on writing DSL in Erlang. I remember him talking to me &ldquo;I&rsquo;m giving a talk on implementing DSL in Erlang.&rdquo; I said &ldquo;Oh, yeah.&rdquo; And he said &ldquo;I don&rsquo;t know anything about it. I better implement Lua.&rdquo;</p></blockquote>

<p>It&rsquo;s a really good idea to submit a conference proposal for the stuff you want to learn. When the proposal is accepted, you don&rsquo;t have a choice but go and study the thing. Otherwise you would procrastinate forever. I notice actually many people do that. Maybe I&rsquo;ll do the same with Erlang, at some point.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Stuck with your first programming language]]></title>
    <link href="http://blog.ndpar.com/2013/05/09/liskov-programming-abstraction/"/>
    <updated>2013-05-09T19:39:00-04:00</updated>
    <id>http://blog.ndpar.com/2013/05/09/liskov-programming-abstraction</id>
    <content type="html"><![CDATA[<p><a href="http://en.wikipedia.org/wiki/Barbara_Liskov">Barbara Liskov</a> in her <a href="http://www.infoq.com/presentations/programming-abstraction-liskov">keynote</a> presentation:</p>

<blockquote><p>I&rsquo;m a little dismayed what&rsquo;s happened in programming languages. And the reason I&rsquo;m dismayed is because on the one hand we have the programming languages that experts use — I&rsquo;m thinking of Java and C# but you can name bunch of others. And the problem with these languages is — they are powerful, you can build big systems in them — but they aren&rsquo;t very good for beginners. And what happens in MIT, and I think this is happening across the US anyway, is the people are no longer using those languages in their introductory programming language courses, because the amount of craft you have to go through in order to write the little print-loop is just too much, and the students just get lost in the process. So they&rsquo;ve been switching to languages like Python.</p>

<p>Python is very simple and nice when you start to use it. But you don&rsquo;t get too far down the road, if you me, before you discover it has no data abstraction at all. That&rsquo;s not good because big programs require modularity and encapsulation, and you&rsquo;d like the language that supports that. So my question is: Can we find a language that will work for both communities? And the reason it matters is because a lot of kids start off programming in their first programming language and that&rsquo;s it. They may have to change eventually, but they are building huge systems in languages that are really ill-suited for this. So it would be good if the language they started off with is the one they can grow with, and would be good for building big programs as well as small ones.</p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Simple Zookeeper cluster]]></title>
    <link href="http://blog.ndpar.com/2013/03/09/simple-zookeeper-cluster/"/>
    <updated>2013-03-09T07:00:00-05:00</updated>
    <id>http://blog.ndpar.com/2013/03/09/simple-zookeeper-cluster</id>
    <content type="html"><![CDATA[<p>Sometimes I need to run <a href="http://zookeeper.apache.org">ZooKeeper</a> ensemble on my development box to test my application on the production-like environment. I found that recreating the whole ensemble from scratch is much faster than cleaning it up using ZooKeeper CLI tool. To automate this process I created a bash script which I want to share in this blog post. I hard-coded all the paths in the script using my regular conventions. You might need to change them to yours — it should be fairly straightforward.</p>

<p>Before you can use the script, you need to install ZooKeeper on your box. That&rsquo;s what I did on my machine</p>

<pre><code>$ cd /opt
$ sudo mkdir zookeeper
$ sudo chown -R andrey:admin zookeeper
$ cd zookeeper
$ wget http://apache.mirror.rafal.ca/zookeeper/zookeeper-3.4.5/zookeeper-3.4.5.tar.gz
$ tar xf zookeeper-3.4.5.tar.gz
$ rm zookeeper-3.4.5.tar.gz
$ ln -s zookeeper-3.4.5 zookeeper
</code></pre>

<p>In the end you should have a ZooKeeper installed in <em>/opt/zookeeper/zookeeper</em> directory.</p>

<p>Now download, chmod, and run the <a href="https://gist.github.com/ndpar/5105486">script</a>. It will create the following files</p>

<pre><code>/opt/zookeeper/zookeeper/cluster
├── server1
│   ├── conf
│   │   ├── log4j.properties
│   │   └── zoo.cfg
│   ├── data
│   │   └── myid
│   └── logs
├── server2
│   ├── conf
│   │   ├── log4j.properties
│   │   └── zoo.cfg
│   ├── data
│   │   └── myid
│   └── logs
├── server3
│   ├── conf
│   │   ├── log4j.properties
│   │   └── zoo.cfg
│   ├── data
│   │   └── myid
│   └── logs
├── start.sh
└── stop.sh
</code></pre>

<p>This is the minimum configuration for 3-node ensemble (cluster), which is recommended for production. To start the cluster, run the following command</p>

<pre><code>$ cd /opt/zookeeper/zookeeper
$ cluster/start.sh
</code></pre>

<p>Check the log files to see if the cluster is successfully started</p>

<pre><code>$ tail -f cluster/server{1,2,3}/logs/zookeeper.out
</code></pre>

<p>When the cluster is up and running, you can test your application. After you are done, shutdown the cluster using the following command</p>

<pre><code>$ cluster/stop.sh
$ ps -ef | grep java
</code></pre>

<p>To recreate a clean cluster, just run the script again</p>

<pre><code>$ ./zookeeper-init-ensemble.sh
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Embrace Big Data]]></title>
    <link href="http://blog.ndpar.com/2013/01/15/embrace-big-data/"/>
    <updated>2013-01-15T07:00:00-05:00</updated>
    <id>http://blog.ndpar.com/2013/01/15/embrace-big-data</id>
    <content type="html"><![CDATA[<p><img class="center" src="http://blog.ndpar.com/images/posts/BigData.jpg"></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[RabbitMQ, ActiveMQ, ZeroMQ, HornetQ]]></title>
    <link href="http://blog.ndpar.com/2012/12/15/rabbitmq-activemq-zeromq-hornetq/"/>
    <updated>2012-12-15T07:00:00-05:00</updated>
    <id>http://blog.ndpar.com/2012/12/15/rabbitmq-activemq-zeromq-hornetq</id>
    <content type="html"><![CDATA[<p><em>Warning</em>: In this post I&rsquo;m going to compare <a href="http://www.rabbitmq.com/">RabbitMQ</a>, <a href="http://www.zeromq.org/">ZeroMQ</a>, <a href="http://activemq.apache.org/">ActiveMQ</a>, and <a href="http://www.jboss.org/hornetq">HornetQ</a>. The basis of the comparison is not the performance, or the scalability, or any other serious feature. The comparison is done <em>purely</em> based on the popularity of those systems. Therefore, if you came here to see some performance metrics, you will be disappointed — there is none in this post.</p>

<p><em>Note</em>: To calculate popularity, I&rsquo;m going to use MongoDB and Python, so if you don&rsquo;t care about message brokers, but you want to see some examples of MongoDB scripts, this post might be interesting to you.</p>

<!-- more -->


<h2>Popularity</h2>

<p>What is the best messaging system out there? If you read my blog regularly, you probably know my biased answer. But to give an objective answer, we have to compare the candidates based on some criteria. There are many possible criteria, some of which are more relevant to your project than the others. One of them is how popular the candidate solutions are. In other words, if you choose a message broker and then you encounter a problem, how easy would it be to solve it? Is there anybody who can help you? One way to find it out is to check how many people are interested in the same solution. And the obvious way to do it is to ask Google.</p>

<p>Here is the Google trend graph for the last five years. It turns out, my personal preferences coincide with the public interest.</p>

<div class="separator" style="clear: both; text-align: center;"><script type="text/javascript" src="http://blog.ndpar.com//www.google.ca/trends/embed.js?hl=en-US&q=activemq,+rabbitmq,+zeromq,+hornetq&date=1/2008+60m&cmpt=q&content=1&cid=TIMESERIES_GRAPH_AVERAGES_CHART&export=5&w=800&h=330"></script></div>


<p>At this point I can stop and say &ldquo;Well, you see who&rsquo;s the winner&rdquo;. There are 5 times more people interested in RabbitMQ than HornetQ, so if you bet on Rabbit you have more chances to get the help from your fellow programmers, if you need to.</p>

<p>But before we make the final decision, I want to hear another opinion about the popularity of our candidates. Where do people go nowadays when they have software related problems? Right, they go to…</p>

<h2>StackOverflow</h2>

<p>The best thing about StackOverflow is their <a href="http://api.stackoverflow.com/1.0/usage">REST API</a>. For our purposes we need two API queries: get all <a href="http://api.stackoverflow.com/1.1/usage/methods/search">questions by a tag</a>, and get all <a href="http://api.stackoverflow.com/1.1/usage/methods/question-answers">answers</a> for the question. In fact, the second one is optional. Even the first query alone can give us most of what we want to know:</p>

<ul>
<li>how many questions have been posted for every candidate on our list?</li>
<li>how many answers did those questions receive?</li>
<li>how many answers were accepted?</li>
<li>how many questions and answers were marked useful?</li>
</ul>


<p>When we get all the numbers, we should know what people are actually using. We can also check if there is any correlation between Google data and StackOverflow.</p>

<p>So how do we proceed? We cannot use API directly to run analytics, because we would quickly exhaust the daily quota. What we can do is to fetch the data, save it locally, and run analytics against the local data. Here is another good thing about StackOverflow API: it comes in JSON format. What is the best way to analyze JSON data? Obviously, saving it in a JSON-oriented database that supports aggregated queries. And that&rsquo;s where MongoDB comes into play.</p>

<p><a href="https://gist.github.com/4276136#file-questions-py">Here</a> is the Python script that downloads all the questions for the specified tags from StackOverflow, and saves the results in the local MongoDB instance. I chose Python because I want to draw some graphs later, which is easy to do in Python. Plus, it&rsquo;s a simple and expressive language.</p>

<p>After we run this script, we get all the questions we need in our database. The next step is to get all the answers for those questions. <a href="https://gist.github.com/4276136#file-answers-py">Here</a> is the script that does exactly that.</p>

<p>Depends on how many questions we have saved on the first step, there might be quite a lot of queries to run to get all the answers. With my second script I exceeded the daily quota, so I had to wait for the next day to get the rest of the answers.</p>

<p>Now, when we have all the data, let&rsquo;s take a look how we can use it. Here is a typical StackOverflow record. I highlighted the fields that might be useful for our analysis.</p>

<pre>{
     "_id" : 269363,
     <font color="#0000FF">"accepted_answer_id"</font> : 290764,
     <font color="#0000FF">"answer_count" : 4</font>,
     "answers" : [
          ...
          {
               "view_count" : 0,
               "answer_comments_url" : "/answers/303710/comments",
               "answer_id" : 303710,
               "title" : "ActiveMQ .net client locks up",
               "community_owned" : false,
               "down_vote_count" : 0,
               "last_activity_date" : 1317300099,
               "creation_date" : 1227135282,
               "score" : 1,
               <font color="#0000FF">"up_vote_count" : 1</font>,
               "owner" : {
                    "display_name" : "HitLikeAHammer",
                    <font color="#0000FF">"reputation" : 1152</font>,
                    "user_id" : 35165,
                    "user_type" : "registered",
                    "email_hash" : "584cd9905db85f744e7e96740b11b7c0"
               },
               "accepted" : false,
               "last_edit_date" : 1317300099,
               "question_id" : 269363
          },
          ...
     ],
     "community_owned" : false,
     "creation_date" : 1225989513,
     "down_vote_count" : 0,
     "favorite_count" : 1,
     "last_activity_date" : 1317300112,
     "owner" : {
          "display_name" : "HitLikeAHammer",
          "reputation" : 1152,
          "user_id" : 35165,
          "user_type" : "registered",
          "email_hash" : "584cd9905db85f744e7e96740b11b7c0"
     },
     "question_answers_url" : "/questions/269363/answers",
     "question_comments_url" : "/questions/269363/comments",
     "question_id" : 269363,
     "question_timeline_url" : "/questions/269363/timeline",
     "score" : 1,
     <font color="#0000FF">"tags" : [
          ".net",
          "activemq"
     ]</font>,
     "title" : "ActiveMQ .net client locks up",
     <font color="#0000FF">"up_vote_count" : 1</font>,
     "view_count" : 1183
}</pre>


<p>First of all, we want to know how many questions are posted for each messaging system from our list. Here is the MongoDB query for that. The first snippet is a query, the second is the result.</p>

<figure class='code'><figcaption><span>Number of questions </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">db</span><span class="p">.</span><span class="nx">stackoverflow</span><span class="p">.</span><span class="nx">aggregate</span><span class="p">([</span>
</span><span class='line'>     <span class="p">{</span><span class="nx">$unwind</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">},</span>
</span><span class='line'>     <span class="p">{</span><span class="nx">$group</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">,</span> <span class="nx">questions</span><span class="o">:</span><span class="p">{</span><span class="nx">$sum</span><span class="o">:</span><span class="mi">1</span><span class="p">}}},</span>
</span><span class='line'>     <span class="p">{</span><span class="nx">$match</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="p">{</span><span class="nx">$in</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;activemq&#39;</span><span class="p">,</span> <span class="s1">&#39;rabbitmq&#39;</span><span class="p">,</span> <span class="s1">&#39;zeromq&#39;</span><span class="p">,</span> <span class="s1">&#39;hornetq&#39;</span><span class="p">]}}},</span>
</span><span class='line'>     <span class="p">{</span><span class="nx">$sort</span><span class="o">:</span><span class="p">{</span><span class="nx">questions</span><span class="o">:-</span><span class="mi">1</span><span class="p">}}</span>
</span><span class='line'><span class="p">])[</span><span class="s1">&#39;result&#39;</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">[</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;activemq&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">1039</span>
</span><span class='line'>     <span class="p">},</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;rabbitmq&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">988</span>
</span><span class='line'>     <span class="p">},</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;zeromq&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">373</span>
</span><span class='line'>     <span class="p">},</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;hornetq&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">185</span>
</span><span class='line'>     <span class="p">}</span>
</span><span class='line'><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>The next query is to get the total number of answers by tag</p>

<figure class='code'><figcaption><span>Number of answers </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">db</span><span class="p">.</span><span class="nx">stackoverflow</span><span class="p">.</span><span class="nx">aggregate</span><span class="p">([</span>
</span><span class='line'>     <span class="p">{</span><span class="nx">$unwind</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">},</span>
</span><span class='line'>     <span class="p">{</span><span class="nx">$group</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">,</span> <span class="nx">answers</span><span class="o">:</span><span class="p">{</span><span class="nx">$sum</span><span class="o">:</span><span class="s1">&#39;$answer_count&#39;</span><span class="p">}}},</span>
</span><span class='line'>     <span class="p">{</span><span class="nx">$match</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="p">{</span><span class="nx">$in</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;activemq&#39;</span><span class="p">,</span> <span class="s1">&#39;rabbitmq&#39;</span><span class="p">,</span> <span class="s1">&#39;zeromq&#39;</span><span class="p">,</span> <span class="s1">&#39;hornetq&#39;</span><span class="p">]}}},</span>
</span><span class='line'>     <span class="p">{</span><span class="nx">$sort</span><span class="o">:</span><span class="p">{</span><span class="nx">answers</span><span class="o">:-</span><span class="mi">1</span><span class="p">}}</span>
</span><span class='line'><span class="p">])[</span><span class="s1">&#39;result&#39;</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">[</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;activemq&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;answers&quot;</span> <span class="o">:</span> <span class="mi">1382</span>
</span><span class='line'>     <span class="p">},</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;rabbitmq&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;answers&quot;</span> <span class="o">:</span> <span class="mi">1322</span>
</span><span class='line'>     <span class="p">},</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;zeromq&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;answers&quot;</span> <span class="o">:</span> <span class="mi">572</span>
</span><span class='line'>     <span class="p">},</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;hornetq&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;answers&quot;</span> <span class="o">:</span> <span class="mi">227</span>
</span><span class='line'>     <span class="p">}</span>
</span><span class='line'><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>It seems that the number of answers is proportional to the number of questions. With MongoDB we can quickly verify it.</p>

<figure class='code'><figcaption><span>Answers to questions ratio </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">db</span><span class="p">.</span><span class="nx">stackoverflow</span><span class="p">.</span><span class="nx">aggregate</span><span class="p">([</span>
</span><span class='line'>     <span class="p">{</span><span class="nx">$unwind</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">},</span>
</span><span class='line'>     <span class="p">{</span><span class="nx">$group</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">,</span> <span class="nx">answers</span><span class="o">:</span><span class="p">{</span><span class="nx">$sum</span><span class="o">:</span><span class="s1">&#39;$answer_count&#39;</span><span class="p">},</span> <span class="nx">questions</span><span class="o">:</span><span class="p">{</span><span class="nx">$sum</span><span class="o">:</span><span class="mi">1</span><span class="p">}}},</span>
</span><span class='line'>     <span class="p">{</span><span class="nx">$match</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="p">{</span><span class="nx">$in</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;activemq&#39;</span><span class="p">,</span> <span class="s1">&#39;rabbitmq&#39;</span><span class="p">,</span> <span class="s1">&#39;zeromq&#39;</span><span class="p">,</span> <span class="s1">&#39;hornetq&#39;</span><span class="p">]}}},</span>
</span><span class='line'>     <span class="p">{</span><span class="nx">$project</span><span class="o">:</span><span class="p">{</span><span class="nx">answers</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">questions</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">ratio</span><span class="o">:</span><span class="p">{</span><span class="nx">$divide</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;$answers&#39;</span><span class="p">,</span> <span class="s1">&#39;$questions&#39;</span><span class="p">]}}},</span>
</span><span class='line'>     <span class="p">{</span><span class="nx">$sort</span><span class="o">:</span><span class="p">{</span><span class="nx">ratio</span><span class="o">:-</span><span class="mi">1</span><span class="p">}}</span>
</span><span class='line'><span class="p">])[</span><span class="s1">&#39;result&#39;</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">[</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;zeromq&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;answers&quot;</span> <span class="o">:</span> <span class="mi">572</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">373</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;ratio&quot;</span> <span class="o">:</span> <span class="mf">1.5335120643431635</span>
</span><span class='line'>     <span class="p">},</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;rabbitmq&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;answers&quot;</span> <span class="o">:</span> <span class="mi">1322</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">988</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;ratio&quot;</span> <span class="o">:</span> <span class="mf">1.3380566801619433</span>
</span><span class='line'>     <span class="p">},</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;activemq&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;answers&quot;</span> <span class="o">:</span> <span class="mi">1382</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">1039</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;ratio&quot;</span> <span class="o">:</span> <span class="mf">1.3301251203079885</span>
</span><span class='line'>     <span class="p">},</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;hornetq&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;answers&quot;</span> <span class="o">:</span> <span class="mi">227</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">185</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;ratio&quot;</span> <span class="o">:</span> <span class="mf">1.227027027027027</span>
</span><span class='line'>     <span class="p">}</span>
</span><span class='line'><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Indeed, the answers/question ratio is almost the same for every tag. That means we can use just the number of questions for our analysis.</p>

<p>Here is the query that calculates the number of <em>accepted</em> answers by tag. Again, it correlates fairly well with the total number of answers and questions.</p>

<figure class='code'><figcaption><span>Number of accepted answers </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">db</span><span class="p">.</span><span class="nx">stackoverflow</span><span class="p">.</span><span class="nx">aggregate</span><span class="p">([</span>
</span><span class='line'>     <span class="p">{</span><span class="nx">$match</span><span class="o">:</span><span class="p">{</span><span class="nx">accepted_answer_id</span><span class="o">:</span><span class="p">{</span><span class="nx">$ne</span><span class="o">:</span><span class="kc">null</span><span class="p">}}},</span>
</span><span class='line'>     <span class="p">{</span><span class="nx">$unwind</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">},</span>
</span><span class='line'>     <span class="p">{</span><span class="nx">$group</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">,</span> <span class="nx">accepted_answers</span><span class="o">:</span><span class="p">{</span><span class="nx">$sum</span><span class="o">:</span><span class="mi">1</span><span class="p">}}},</span>
</span><span class='line'>     <span class="p">{</span><span class="nx">$match</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="p">{</span><span class="nx">$in</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;activemq&#39;</span><span class="p">,</span> <span class="s1">&#39;rabbitmq&#39;</span><span class="p">,</span> <span class="s1">&#39;zeromq&#39;</span><span class="p">,</span> <span class="s1">&#39;hornetq&#39;</span><span class="p">]}}},</span>
</span><span class='line'>     <span class="p">{</span><span class="nx">$sort</span><span class="o">:</span><span class="p">{</span><span class="nx">accepted_answers</span><span class="o">:-</span><span class="mi">1</span><span class="p">}}</span>
</span><span class='line'><span class="p">])[</span><span class="s1">&#39;result&#39;</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">[</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;activemq&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;accepted_answers&quot;</span> <span class="o">:</span> <span class="mi">531</span>
</span><span class='line'>     <span class="p">},</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;rabbitmq&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;accepted_answers&quot;</span> <span class="o">:</span> <span class="mi">500</span>
</span><span class='line'>     <span class="p">},</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;zeromq&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;accepted_answers&quot;</span> <span class="o">:</span> <span class="mi">221</span>
</span><span class='line'>     <span class="p">},</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;hornetq&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;accepted_answers&quot;</span> <span class="o">:</span> <span class="mi">94</span>
</span><span class='line'>     <span class="p">}</span>
</span><span class='line'><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>The next query is more interesting. It calculates the number of question up-votes by tag. In other words, it shows the number of <em>useful</em> questions. If we divide it by the total number of questions, we should see which messaging system has bigger rate of useful questions than others</p>

<figure class='code'><figcaption><span>Number of useful questions </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">db</span><span class="p">.</span><span class="nx">stackoverflow</span><span class="p">.</span><span class="nx">aggregate</span><span class="p">([</span>
</span><span class='line'>     <span class="p">{</span><span class="nx">$unwind</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">},</span>
</span><span class='line'>     <span class="p">{</span><span class="nx">$group</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">,</span> <span class="nx">upvotes</span><span class="o">:</span><span class="p">{</span><span class="nx">$sum</span><span class="o">:</span><span class="s1">&#39;$up_vote_count&#39;</span><span class="p">},</span> <span class="nx">questions</span><span class="o">:</span><span class="p">{</span><span class="nx">$sum</span><span class="o">:</span><span class="mi">1</span><span class="p">}}},</span>
</span><span class='line'>     <span class="p">{</span><span class="nx">$match</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="p">{</span><span class="nx">$in</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;activemq&#39;</span><span class="p">,</span> <span class="s1">&#39;rabbitmq&#39;</span><span class="p">,</span> <span class="s1">&#39;zeromq&#39;</span><span class="p">,</span> <span class="s1">&#39;hornetq&#39;</span><span class="p">]}}},</span>
</span><span class='line'>     <span class="p">{</span><span class="nx">$project</span><span class="o">:</span><span class="p">{</span><span class="nx">upvotes</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">questions</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">ratio</span><span class="o">:</span><span class="p">{</span><span class="nx">$divide</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;$upvotes&#39;</span><span class="p">,</span> <span class="s1">&#39;$questions&#39;</span><span class="p">]}}},</span>
</span><span class='line'>     <span class="p">{</span><span class="nx">$sort</span><span class="o">:</span><span class="p">{</span><span class="nx">ratio</span><span class="o">:-</span><span class="mi">1</span><span class="p">}}</span>
</span><span class='line'><span class="p">])[</span><span class="s1">&#39;result&#39;</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">[</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;zeromq&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;upvotes&quot;</span> <span class="o">:</span> <span class="mi">1078</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">373</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;ratio&quot;</span> <span class="o">:</span> <span class="mf">2.8900804289544237</span>
</span><span class='line'>     <span class="p">},</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;rabbitmq&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;upvotes&quot;</span> <span class="o">:</span> <span class="mi">1864</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">988</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;ratio&quot;</span> <span class="o">:</span> <span class="mf">1.8866396761133604</span>
</span><span class='line'>     <span class="p">},</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;activemq&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;upvotes&quot;</span> <span class="o">:</span> <span class="mi">1459</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">1039</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;ratio&quot;</span> <span class="o">:</span> <span class="mf">1.4042348411934553</span>
</span><span class='line'>     <span class="p">},</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;hornetq&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;upvotes&quot;</span> <span class="o">:</span> <span class="mi">233</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">185</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;ratio&quot;</span> <span class="o">:</span> <span class="mf">1.2594594594594595</span>
</span><span class='line'>     <span class="p">}</span>
</span><span class='line'><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Interesting. The ZeroMQ users seem to ask more useful questions than the users of other brokers.</p>

<p>Let&rsquo;s do the same analysis for the answers. Here is the query that calculates the number of answer up-votes by tag.</p>

<figure class='code'><figcaption><span>Number of useful answers </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">db</span><span class="p">.</span><span class="nx">stackoverflow</span><span class="p">.</span><span class="nx">aggregate</span><span class="p">([</span>
</span><span class='line'>     <span class="p">{</span><span class="nx">$unwind</span><span class="o">:</span><span class="s1">&#39;$answers&#39;</span><span class="p">},</span>
</span><span class='line'>     <span class="p">{</span><span class="nx">$unwind</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">},</span>
</span><span class='line'>     <span class="p">{</span><span class="nx">$group</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="p">{</span><span class="nx">question</span><span class="o">:</span><span class="s1">&#39;$_id&#39;</span><span class="p">,</span> <span class="nx">tag</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">},</span> <span class="nx">upvotes</span><span class="o">:</span><span class="p">{</span><span class="nx">$sum</span><span class="o">:</span><span class="s1">&#39;$answers.up_vote_count&#39;</span><span class="p">}}},</span>
</span><span class='line'>     <span class="p">{</span><span class="nx">$group</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="s1">&#39;$_id.tag&#39;</span><span class="p">,</span> <span class="nx">upvotes</span><span class="o">:</span><span class="p">{</span><span class="nx">$sum</span><span class="o">:</span><span class="s1">&#39;$upvotes&#39;</span><span class="p">},</span> <span class="nx">questions</span><span class="o">:</span><span class="p">{</span><span class="nx">$sum</span><span class="o">:</span><span class="mi">1</span><span class="p">}}},</span>
</span><span class='line'>     <span class="p">{</span><span class="nx">$match</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="p">{</span><span class="nx">$in</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;activemq&#39;</span><span class="p">,</span> <span class="s1">&#39;rabbitmq&#39;</span><span class="p">,</span> <span class="s1">&#39;zeromq&#39;</span><span class="p">,</span> <span class="s1">&#39;hornetq&#39;</span><span class="p">]}}},</span>
</span><span class='line'>     <span class="p">{</span><span class="nx">$project</span><span class="o">:</span><span class="p">{</span><span class="nx">upvotes</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">questions</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">ratio</span><span class="o">:</span><span class="p">{</span><span class="nx">$divide</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;$upvotes&#39;</span><span class="p">,</span> <span class="s1">&#39;$questions&#39;</span><span class="p">]}}},</span>
</span><span class='line'>     <span class="p">{</span><span class="nx">$sort</span><span class="o">:</span><span class="p">{</span><span class="nx">ratio</span><span class="o">:-</span><span class="mi">1</span><span class="p">}}</span>
</span><span class='line'><span class="p">])[</span><span class="s1">&#39;result&#39;</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">[</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;zeromq&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;upvotes&quot;</span> <span class="o">:</span> <span class="mi">1469</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">338</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;ratio&quot;</span> <span class="o">:</span> <span class="mf">4.346153846153846</span>
</span><span class='line'>     <span class="p">},</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;rabbitmq&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;upvotes&quot;</span> <span class="o">:</span> <span class="mi">2437</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">858</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;ratio&quot;</span> <span class="o">:</span> <span class="mf">2.84032634032634</span>
</span><span class='line'>     <span class="p">},</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;activemq&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;upvotes&quot;</span> <span class="o">:</span> <span class="mi">2199</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">902</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;ratio&quot;</span> <span class="o">:</span> <span class="mf">2.4379157427937916</span>
</span><span class='line'>     <span class="p">},</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;hornetq&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;upvotes&quot;</span> <span class="o">:</span> <span class="mi">262</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">156</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;ratio&quot;</span> <span class="o">:</span> <span class="mf">1.6794871794871795</span>
</span><span class='line'>     <span class="p">}</span>
</span><span class='line'><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Again, ZeroMQ users post more useful answers than others.</p>

<p>To complete the picture of typical users, let&rsquo;s run the following query that calculates an average reputation of people that post answers</p>

<figure class='code'><figcaption><span>Reputation of respondents </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">db</span><span class="p">.</span><span class="nx">stackoverflow</span><span class="p">.</span><span class="nx">aggregate</span><span class="p">([</span>
</span><span class='line'>     <span class="p">{</span><span class="nx">$unwind</span><span class="o">:</span><span class="s1">&#39;$answers&#39;</span><span class="p">},</span>
</span><span class='line'>     <span class="p">{</span><span class="nx">$unwind</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">},</span>
</span><span class='line'>     <span class="p">{</span><span class="nx">$group</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="p">{</span><span class="nx">question</span><span class="o">:</span><span class="s1">&#39;$_id&#39;</span><span class="p">,</span> <span class="nx">tag</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">},</span> <span class="nx">reputation</span><span class="o">:</span><span class="p">{</span><span class="nx">$avg</span><span class="o">:</span><span class="s1">&#39;$answers.owner.reputation&#39;</span><span class="p">}}},</span>
</span><span class='line'>     <span class="p">{</span><span class="nx">$group</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="s1">&#39;$_id.tag&#39;</span><span class="p">,</span> <span class="nx">reputation</span><span class="o">:</span><span class="p">{</span><span class="nx">$avg</span><span class="o">:</span><span class="s1">&#39;$reputation&#39;</span><span class="p">}}},</span>
</span><span class='line'>     <span class="p">{</span><span class="nx">$match</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="p">{</span><span class="nx">$in</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;activemq&#39;</span><span class="p">,</span> <span class="s1">&#39;rabbitmq&#39;</span><span class="p">,</span> <span class="s1">&#39;zeromq&#39;</span><span class="p">,</span> <span class="s1">&#39;hornetq&#39;</span><span class="p">]}}},</span>
</span><span class='line'>     <span class="p">{</span><span class="nx">$sort</span><span class="o">:</span><span class="p">{</span><span class="nx">reputation</span><span class="o">:-</span><span class="mi">1</span><span class="p">}}</span>
</span><span class='line'><span class="p">])[</span><span class="s1">&#39;result&#39;</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">[</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;zeromq&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;reputation&quot;</span> <span class="o">:</span> <span class="mf">10088.29552338687</span>
</span><span class='line'>     <span class="p">},</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;activemq&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;reputation&quot;</span> <span class="o">:</span> <span class="mf">7298.7539383380845</span>
</span><span class='line'>     <span class="p">},</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;rabbitmq&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;reputation&quot;</span> <span class="o">:</span> <span class="mf">6082.172231934734</span>
</span><span class='line'>     <span class="p">},</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;hornetq&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;reputation&quot;</span> <span class="o">:</span> <span class="mf">3472.9658119658116</span>
</span><span class='line'>     <span class="p">}</span>
</span><span class='line'><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Wow. ZeroMQ users not only ask more useful questions and give useful answers, they also have higher reputation on average in the StackOverflow community.</p>

<p>As a final exercise, I want to build a graph of question distribution over time. After all, ActiveMQ is the oldest broker, and it might have got more questions just because it was launched first. For this purpose I created <a href="https://gist.github.com/4276136#file-trends-py">this</a> Python script that uses amazing <a href="http://matplotlib.org/gallery.html">matplotlib</a> library. And here is the result for the last 60 months</p>

<p><img class="center" src="http://blog.ndpar.com/images/posts/mom-trends-so.png"></p>

<p>It shows that the proportion of interest in different massaging systems was approximately the same all the time. Furthermore, the StackOverflow statistics of this year correlates well with the Google statistics.</p>

<h2>Conclusion</h2>

<ol>
<li><p>RabbitMQ and ActiveMQ are very popular. If you choose one of them for your messaging infrastructure, you shouldn&rsquo;t have any problem with the community support. HornetQ might be a good message broker but it definitely lacks the community interest. Finally, as I <a href="http://blog.ndpar.com/2012/11/12/pycon-canada-2012/#learn">suspected</a> before, ZeroMQ is worth looking at. There are bunch of smart and helpful people in ZeroMQ community.</p></li>
<li><p>MongoDB is really nice! Its aggregation framework is powerful and easy to use. It was fun playing with it.</p></li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Code Retreat 2012]]></title>
    <link href="http://blog.ndpar.com/2012/12/09/code-retreat-2012/"/>
    <updated>2012-12-09T07:00:00-05:00</updated>
    <id>http://blog.ndpar.com/2012/12/09/code-retreat-2012</id>
    <content type="html"><![CDATA[<p>Yesterday was the Global Day of Code Retreat. Software engineers around the globe met together to learn from each other.</p>

<p><img class="center" src="https://pbs.twimg.com/media/A9mptOCCAAE0d7z.jpg" title="CR2012 1" ></p>

<p>There were several sessions where people were pair-programming <a href="http://en.wikipedia.org/wiki/Conway's_Game_of_Life">Conway&rsquo;s Game of Life</a>.</p>

<p><img class="center" src="https://pbs.twimg.com/media/A9nZYcTCQAEVtkP.jpg" title="CR2012 2" ></p>

<p>Each session you had to choose a new partner, so that both of you can learn something new.</p>

<p><img class="center" src="https://pbs.twimg.com/media/A9n_aHzCcAARnkJ.jpg" title="CR2012 3" ></p>

<p>During the first session my partner and I decided to implement the Game in Java, mainly because it was the language she was most comfortable with. We implemented the procedural solution using two-dimensional array and nested loops. At that moment that was the only solution I could think of. The main challenge was to cover all edge cases and fix all <code>ArrayIndexOutOfBoundsException</code>s. Java is fairly verbose language, and with nested loops and if-else statements the final solution was pretty hard to read. You can see <a href="http://rosettacode.org/wiki/Conway's_Game_of_Life#Java">here</a> how it might look like.</p>

<p>First session was a warmup, during which most people realized that programming arrays is a tedious work. For the second session my new partner suggested an object-oriented approach, where you would operate on Cell objects that would encapsulate coordinates on the grid. In this case you move the game logic from the grid to the cell, making it easier to calculate a new state. This was my first acquaintance with C#. Interesting language — basically, Java with lambdas. Here is an <a href="http://rosettacode.org/wiki/Conway's_Game_of_Life#C.23">example</a> of C# implementation. Our solution was very similar.</p>

<p>While the first session&rsquo;s data structure was array of booleans, on the second session it was replaced by a list of objects. The next step would be to relax the data structure even further. We decided to experiment with un-ordered set of coordinate pairs. For language we chose Clojure. Although we didn&rsquo;t finish the implementation, by the end of the session we had a clear picture how to solve the problem in functional style.</p>

<p>On the fourth session the facilitators put an interesting constraint: the coding must be done in absolute silence. That was the most amazing experience of the day. Before we started I thought we couldn&rsquo;t accomplish much without talking. As it turned out, we could. The key of effective silent coding is to use the tools which both partners are familiar with. In our case we both were advanced users of Vim, and we knew Lisp languages. Our Clojure implementation was based on map/filter/reduce approach and spanned 20 lines of code. After the session <a href="http://langnostic.blogspot.com">Leo</a> showed me Christophe Grand&rsquo;s <a href="http://clj-me.cgrand.net/2011/08/19/conways-game-of-life/">7-line solution</a> based on list comprehensions. It is so wonderful that I want to post it here</p>

<figure class='code'><figcaption><span>life.clj </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">neighbours</span> <span class="p">[[</span><span class="nv">x</span> <span class="nv">y</span><span class="p">]]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">for </span><span class="p">[</span><span class="nv">dx</span> <span class="p">[</span><span class="mi">-1</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">]</span> <span class="nv">dy</span> <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">zero? </span><span class="nv">dx</span><span class="p">)</span> <span class="p">[</span><span class="mi">-1</span> <span class="mi">1</span><span class="p">]</span> <span class="p">[</span><span class="mi">-1</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">])]</span>
</span><span class='line'>    <span class="p">[(</span><span class="nb">+ </span><span class="nv">dx</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">dy</span> <span class="nv">y</span><span class="p">)]))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">step</span> <span class="p">[</span><span class="nv">cells</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">set </span><span class="p">(</span><span class="nb">for </span><span class="p">[[</span><span class="nv">loc</span> <span class="nv">n</span><span class="p">]</span> <span class="p">(</span><span class="nf">frequencies</span> <span class="p">(</span><span class="nb">mapcat </span><span class="nv">neighbours</span> <span class="nv">cells</span><span class="p">))</span>
</span><span class='line'>             <span class="ss">:when</span> <span class="p">(</span><span class="nb">or </span><span class="p">(</span><span class="nb">= </span><span class="nv">n</span> <span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="nb">and </span><span class="p">(</span><span class="nb">= </span><span class="nv">n</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nf">cells</span> <span class="nv">loc</span><span class="p">)))]</span>
</span><span class='line'>         <span class="nv">loc</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure>


<p>For the last session we chose Erlang. Because we already knew how to implement the functional solution, that was just an exercise of translating Clojure code into Erlang. Unfortunately we didn&rsquo;t find an equivalent of <code>frequencies</code> function in the standard library, so we implemented it ourselves. Other than that, the Erlang code is almost identical to Clojure.</p>

<figure class='code'><figcaption><span>life.erl </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="p">-</span><span class="ni">import</span><span class="p">(</span><span class="n">sets</span><span class="p">,</span> <span class="p">[</span><span class="n">from_list</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span> <span class="n">to_list</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span> <span class="n">is_element</span><span class="o">/</span><span class="mi">2</span><span class="p">]).</span>
</span><span class='line'>
</span><span class='line'><span class="nf">neighbours</span><span class="p">({</span><span class="nv">X</span><span class="p">,</span> <span class="nv">Y</span><span class="p">})</span> <span class="o">-&gt;</span>
</span><span class='line'>    <span class="p">[{</span><span class="nv">X</span> <span class="o">+</span> <span class="nv">DX</span><span class="p">,</span> <span class="nv">Y</span> <span class="o">+</span> <span class="nv">DY</span><span class="p">}</span> <span class="p">||</span> <span class="nv">DX</span> <span class="o">&lt;-</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="nv">DY</span> <span class="o">&lt;-</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">{</span><span class="nv">DX</span><span class="p">,</span> <span class="nv">DY</span><span class="p">}</span> <span class="o">=/=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">}].</span>
</span><span class='line'>
</span><span class='line'><span class="nf">step</span><span class="p">(</span><span class="nv">Cells</span><span class="p">)</span> <span class="o">-&gt;</span>
</span><span class='line'>    <span class="nv">Nbs</span> <span class="o">=</span> <span class="nn">lists</span><span class="p">:</span><span class="nf">flatmap</span><span class="p">(</span><span class="k">fun</span> <span class="n">neighbours</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span> <span class="n">to_list</span><span class="p">(</span><span class="nv">Cells</span><span class="p">)),</span>
</span><span class='line'>    <span class="nv">NewCells</span> <span class="o">=</span> <span class="p">[</span><span class="nv">C</span> <span class="p">||</span> <span class="p">{</span><span class="nv">C</span><span class="p">,</span> <span class="nv">N</span><span class="p">}</span> <span class="o">&lt;-</span> <span class="n">frequencies</span><span class="p">(</span><span class="nv">Nbs</span><span class="p">),</span>
</span><span class='line'>                     <span class="p">(</span><span class="nv">N</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="ow">orelse</span> <span class="p">((</span><span class="nv">N</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">andalso</span> <span class="n">is_element</span><span class="p">(</span><span class="nv">C</span><span class="p">,</span> <span class="nv">Cells</span><span class="p">))],</span>
</span><span class='line'>    <span class="n">from_list</span><span class="p">(</span><span class="nv">NewCells</span><span class="p">).</span>
</span><span class='line'>
</span><span class='line'><span class="nf">frequencies</span><span class="p">(</span><span class="nv">List</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">frequencies</span><span class="p">(</span><span class="nv">List</span><span class="p">,</span> <span class="p">[]).</span>
</span><span class='line'><span class="nf">frequencies</span><span class="p">([],</span> <span class="nv">Acc</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nv">Acc</span><span class="p">;</span>
</span><span class='line'><span class="nf">frequencies</span><span class="p">([</span><span class="nv">X</span><span class="p">|</span><span class="nv">Xs</span><span class="p">],</span> <span class="nv">Acc</span><span class="p">)</span> <span class="o">-&gt;</span>
</span><span class='line'>    <span class="k">case</span> <span class="nn">lists</span><span class="p">:</span><span class="nf">keyfind</span><span class="p">(</span><span class="nv">X</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nv">Acc</span><span class="p">)</span> <span class="k">of</span>
</span><span class='line'>        <span class="p">{</span><span class="nv">X</span><span class="p">,</span> <span class="nv">F</span><span class="p">}</span> <span class="o">-&gt;</span> <span class="n">frequencies</span><span class="p">(</span><span class="nv">Xs</span><span class="p">,</span> <span class="nn">lists</span><span class="p">:</span><span class="nf">keyreplace</span><span class="p">(</span><span class="nv">X</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nv">Acc</span><span class="p">,</span> <span class="p">{</span><span class="nv">X</span><span class="p">,</span> <span class="nv">F</span><span class="o">+</span><span class="mi">1</span><span class="p">}));</span>
</span><span class='line'>        <span class="n">false</span>  <span class="o">-&gt;</span> <span class="n">frequencies</span><span class="p">(</span><span class="nv">Xs</span><span class="p">,</span> <span class="nn">lists</span><span class="p">:</span><span class="nf">keystore</span><span class="p">(</span><span class="nv">X</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nv">Acc</span><span class="p">,</span> <span class="p">{</span><span class="nv">X</span><span class="p">,</span> <span class="mi">1</span><span class="p">}))</span>
</span><span class='line'>    <span class="k">end</span><span class="p">.</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Summary</h2>

<p>During this day I learnt a lot: new language, new abstractions, new techniques, new ways of communication, new ideas. I met bunch of smart people. I was so overwhelmed with all this cool stuff that I had to write this blog post to offload it from my head.</p>

<p>If you are a programmer and you&rsquo;ve never been to Code Retreat, I strongly encourage you to do it next year. It&rsquo;s an exciting experience.</p>

<p>I want to thank all the people who organized and participated in this event.</p>

<h3>Photo Credits</h3>

<ul>
<li>Michael DiBernardo <a href="https://twitter.com/mdibernardo/status/277439446381625345/photo/1">[1]</a></li>
<li>Kunal Gupta <a href="https://twitter.com/kunalfrompolar/status/277491865991921664/photo/1">[2]</a></li>
<li>Carlo Barrettara <a href="https://twitter.com/barrettara/status/277533676273823746/photo/1">[3]</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[PyCon Canada 2012]]></title>
    <link href="http://blog.ndpar.com/2012/11/12/pycon-canada-2012/"/>
    <updated>2012-11-12T15:40:01-05:00</updated>
    <id>http://blog.ndpar.com/2012/11/12/pycon-canada-2012</id>
    <content type="html"><![CDATA[<p>This weekend I attended <a href="http://pycon.ca/">PyCon Canada</a>, the first conference in Canada dedicated to Python ecosystem. As you might find from my blog, I&rsquo;m not a Python guy. I&rsquo;ve been using Python mostly as a scripting language. I went to this conference for fresh ideas, or, as Michael Feathers said, for cross-polination from Python community. This blog post is not a detailed review of the conference — I just want to share my impression in general.</p>

<h2>Organization</h2>

<p>Considering how little time the organizers had for preparing this conference, 5 months I believe, they did amazing job. They invited great speakers. They kept people well informed using mailing list and Twitter. The official web site was clear and easy to navigate. The location was good. The food was decent. The only complaint I had is about the temperature in the rooms on the first day. It was so freezing cold inside that I had to wear my jacket all the time. But on the second day the problem was fixed.</p>

<h2>Keynotes</h2>

<p>Keynotes were absolutely fantastic. There were three of them. Jessica McKellar was talking about Python community. How they foster it, how they attract new people to programming in general and to Python in particular. She shared her experience from organizing Boston Python user group, the biggest Python user group in the world. The takeaway from her talk: Python community is big, welcoming, and well supported by Python Foundation.</p>

<p>Second keynote was Michael Feathers&#8217; <em>Why You Should(n&rsquo;t) be Using a Functional Programming Language Instead</em>. The main idea of his talk is: Don&rsquo;t lock yourself inside one language. Go outside of your community to see what other languages exist out there, how they solved the problems. Study those languages, learn their idioms and techniques, and then go back to your language and start using the ideas you&rsquo;ve learnt. I completely agree with that, and that&rsquo;s why I went to this conference in the first place. He gave bunch of examples of functional programming in Haskell. Then he showed his Ruby code written in functional style, where you could see the influence of Haskell. I liked his presentation because he verbalized the ideas I myself have been thinking about for a while. When I started programming in Groovy my Groovy code was basically a Java code without semicolons. Now my Java code looks more like Groovy.</p>

<p>The closing keynote was by Fernando Pérez, the scientist from University of California, Berkeley, and the creator of IPython. The talk, titled <a href="https://speakerdeck.com/fperez/science-and-python-a-interactively-biased-retrospective-of-a-mostly-successful-decade"><em>Science and Python</em></a>,  was really mind blowing. When I was a student I did all my computations using mainly Fortran and some proprietary software I don&rsquo;t even remember the name of. Later, I played with Mathematica and Octave a little bit. But I didn&rsquo;t know that you can do very sophisticated scientific calculations using Python. Fernando gave some examples from neuroscience, astrophysics and biology, and it&rsquo;s really impressive. The discovery of Supernova PTF11kyl is especially astonishing. From now on, if I need to do some math, I&rsquo;ll be using Python libraries; no more proprietary expensive software. Another theme of the presentation was IPython. Initially I thought it&rsquo;s just a shell on top of the standard Python, but it&rsquo;s actually the whole ecosystem. I cannot explain in a few words how amazing it is. Just google for &ldquo;ipython notebook&rdquo; or read Fernando&rsquo;s <a href="http://blog.fperez.org/2012/09/blogging-with-ipython-notebook.html">blog</a>.</p>

<h2>Talks</h2>

<p>As it happens on every conference, there were some great talks and some lousy talks, interesting talks and boring talks, geeky talks and academic talks. It&rsquo;s all normal and fine. The good thing about this conference though is that signal-noise ratio was pretty high; congratulations to the organizers for choosing talks. Another thing I like is the diversity of formats. There were 45-min presentation, 20-min talks, 5-min lightning talks, 90-min tutorials, and 3-hour workshop (there are also two full day coding sessions but I&rsquo;m not attending them). This is a really good approach. Switching between different formats during the day helps your brain functioning more productive, in my opinion.</p>

<h2>Pleasant discoveries</h2>

<p>I found many projects presented at the conference are using RabbitMQ, and that&rsquo;s great. I wish in Java world people would use AMQP more frequently instead of blindly choosing JMS for every new project.</p>

<p>Many people are using MongoDB properly. Nowadays NoSQL is a very popular buzzword, and many projects are using various NoSQL databases just because it&rsquo;s cool, even if it makes no sense for the project at all. It was nice to see that there are developers out there who do their homework and adopt NoSQL because it fits their domain.</p>

<h2>Unpleasant discoveries</h2>

<p>There seems to be a trend in Python community to despise Java. I actually see this trend in many communities outside of Java, so it&rsquo;s not Python specific, but at this conference I&rsquo;ve heard too many jokes about Java so it&rsquo;s not funny anymore, especially hearing them from the people who don&rsquo;t write a line of code in Java.</p>

<p>Another thing surprised me is the fanatic admiration of Mercurial and hate of Git from some Python programmers. I know lots of people who hate Git, mainly because they are confused and scared by Git. But dislike it for the reason not being written in Python is something new to me.</p>

<h2>Problems in Python</h2>

<p>Package and distribution management in Python is in pretty bad shape. Every person I talked to admitted that it&rsquo;s complete mess at the moment. I myself feel that pain every time I need to install a new library. Which tool should I use: pip, easy_install, pysetup? Some libraries installed using those tools don&rsquo;t work, or work partially. Many programmers use rpm or deb packages instead of Python tools, because OS packages usually work. I came to the same conclusion on my Mac OS. The only flawlessly working Python environment I have is that installed via mac ports. In Java we don&rsquo;t have those problems. Maven solved it once and for all long time ago. Now every JVM language benefits from it. Python community should clean up this mess and standardize their tools. I was told that with introducing PyPi and PEPs the situation is getting better, well, let&rsquo;s see if it resolves all the issues.</p>

<h2>What I&rsquo;ve learnt</h2>

<p>Here is the list of things I found pretty interesting, in no particular order.</p>

<h3>Python libraries to use</h3>

<p>numpy, matplotlib, pandas, scipy, sympy, quantities, collections. Thanks to the people who told me about these libraries.</p>

<h3>Cool Python stuff</h3>

<p>RunSnakeRun &#8212; GUI for Python profiler. Check out the screenshots on their <a href="http://www.vrplumber.com/programming/runsnakerun/">web site</a>. I wish Java profilers could draw such nice graphs.</p>

<p><a href="http://bpython-interpreter.org/screenshots/">bpython</a> &#8212; Python REPL for geeks written in <a href="http://excess.org/urwid/examples.html">Urwid</a>. Thanks to Ian Ward for the really nice <a href="http://pyvideo.org/video/1568/console-applications-with-urwid">presentation</a>.</p>

<h3>Interesting ideas</h3>

<p>Print log statements in JSON format so that you can analyze them using powerful tools. You can also save logs in MongoDB, either offline or asynchronously, and do statistic analysis using aggregation framework.</p>

<p>Write stored procedures in PostgreSQL in Python (and some other languages). They look much better in Python than plSQL.</p>

<h2>Things to learn<a name="learn">&nbsp;</a></h2>

<p>Here are some technology and tools that have a great potential, in my opinion, and worthy of learning: ZeroMQ, IPython, OpenStack. Those were mentioned multiple times during the conference, and I need to check them out in more details.</p>

<h2>Summary</h2>

<p>The conference was great. I&rsquo;m glad I attended it. The organizers did a great job. The conference was beneficial not only to Python community but to Toronto programming community in general. Thanks to all who made it happen.</p>

<p>P.S. Videos from the conference are available <a href="http://pyvideo.org/category/25/pycon-ca-2012">here</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Exporting Solr documents]]></title>
    <link href="http://blog.ndpar.com/2012/10/01/exporting-solr-documents/"/>
    <updated>2012-10-01T08:00:00-04:00</updated>
    <id>http://blog.ndpar.com/2012/10/01/exporting-solr-documents</id>
    <content type="html"><![CDATA[<p>Recently I had to copy some documents from one <a href="http://lucene.apache.org/solr/">Solr</a> server to another. I expected Solr already had an interface that allowed me to extract documents in the same format they were inserted. In that case I would pipe an output of one curl command to another, and consider the job done. As it turned out, the format of Solr input document is different than the output format. Here is how input document looks like:</p>

<pre><code>&lt;add&gt;
    &lt;doc&gt;
        &lt;field name="id"&gt;12345&lt;/field&gt;
        &lt;field name="articlestate"&gt;published&lt;/field&gt;
        &lt;field name="articletype"&gt;news&lt;/field&gt;
        &lt;field name="body"&gt;Lorem ipsum dolor...&lt;/field&gt;
        &lt;field name="referenceid"&gt;175820&lt;/field&gt;
        &lt;field name="referenceid"&gt;163786&lt;/field&gt;
        &lt;field name="created"&gt;2011-02-15T14:57:54.766Z&lt;/field&gt;
    &lt;/doc&gt;
&lt;/add&gt;
</code></pre>

<p>Notice the flat structure of this document: all element names are the same regardless of the filed type, and arrays (referenceid) are not grouped. Now compare it to the output format. Here is what you get when you execute a query against a Solr server:</p>

<pre><code>&lt;response&gt;
    &lt;lst name="responseHeader"&gt;
        &lt;int name="status"&gt;0&lt;/int&gt;
        &lt;int name="QTime"&gt;1&lt;/int&gt;
        &lt;lst name="params"&gt;
            &lt;str name="q"&gt;id:12345&lt;/str&gt;
        &lt;/lst&gt;
    &lt;/lst&gt;
    &lt;result name="response" numFound="1" start="0"&gt;
        &lt;doc&gt;
            &lt;str name="id"&gt;12345&lt;/str&gt;
            &lt;str name="articlestate"&gt;published&lt;/str&gt;
            &lt;str name="articletype"&gt;news&lt;/str&gt;
            &lt;str name="body"&gt;Lorem ipsum dolor...&lt;/str&gt;
            &lt;arr name="referenceid"&gt;
                &lt;str&gt;175820&lt;/str&gt;
                &lt;str&gt;163786&lt;/str&gt;
            &lt;/arr&gt;
            &lt;date name="created"&gt;2011-02-15T14:57:54.766Z&lt;/date&gt;
        &lt;/doc&gt;
    &lt;/result&gt;
&lt;/response&gt;
</code></pre>

<p>Even if we ignore the response header, the structure of the response/result/doc is not the same as of input document: the element names reflect the types, the arrays are grouped. If you try to add this document to a Solr server, you will get an error &ldquo;unexpected XML tag&rdquo;, obviously. I googled for couple hours on how to convert an output document to an input, and, to my surprise, didn&rsquo;t find any solution. Therefore I implemented my own converter in Groovy, which solved the problem. I post it <a href="http://gist.github.com/3813775">here</a> in case somebody needs it.</p>

<p>Note: You can also use this script to re-index Solr.</p>
]]></content>
  </entry>
  
</feed>
