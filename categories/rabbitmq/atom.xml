<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: RabbitMQ | Side Notes]]></title>
  <link href="http://blog.ndpar.com/categories/rabbitmq/atom.xml" rel="self"/>
  <link href="http://blog.ndpar.com/"/>
  <updated>2013-06-03T21:50:29-04:00</updated>
  <id>http://blog.ndpar.com/</id>
  <author>
    <name><![CDATA[Andrey Paramonov]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[RabbitMQ, ActiveMQ, ZeroMQ, HornetQ]]></title>
    <link href="http://blog.ndpar.com/2012/12/15/rabbitmq-activemq-zeromq-hornetq/"/>
    <updated>2012-12-15T07:00:00-05:00</updated>
    <id>http://blog.ndpar.com/2012/12/15/rabbitmq-activemq-zeromq-hornetq</id>
    <content type="html"><![CDATA[<p><em>Warning</em>: In this post I&rsquo;m going to compare <a href="http://www.rabbitmq.com/">RabbitMQ</a>, <a href="http://www.zeromq.org/">ZeroMQ</a>, <a href="http://activemq.apache.org/">ActiveMQ</a>, and <a href="http://www.jboss.org/hornetq">HornetQ</a>. The basis of the comparison is not the performance, or the scalability, or any other serious feature. The comparison is done <em>purely</em> based on the popularity of those systems. Therefore, if you came here to see some performance metrics, you will be disappointed — there is none in this post.</p>

<p><em>Note</em>: To calculate popularity, I&rsquo;m going to use MongoDB and Python, so if you don&rsquo;t care about message brokers, but you want to see some examples of MongoDB scripts, this post might be interesting to you.</p>

<!-- more -->


<h2>Popularity</h2>

<p>What is the best messaging system out there? If you read my blog regularly, you probably know my biased answer. But to give an objective answer, we have to compare the candidates based on some criteria. There are many possible criteria, some of which are more relevant to your project than the others. One of them is how popular the candidate solutions are. In other words, if you choose a message broker and then you encounter a problem, how easy would it be to solve it? Is there anybody who can help you? One way to find it out is to check how many people are interested in the same solution. And the obvious way to do it is to ask Google.</p>

<p>Here is the Google trend graph for the last five years. It turns out, my personal preferences coincide with the public interest.</p>

<div class="separator" style="clear: both; text-align: center;"><script type="text/javascript" src="http://blog.ndpar.com//www.google.ca/trends/embed.js?hl=en-US&q=activemq,+rabbitmq,+zeromq,+hornetq&date=1/2008+60m&cmpt=q&content=1&cid=TIMESERIES_GRAPH_AVERAGES_CHART&export=5&w=800&h=330"></script></div>


<p>At this point I can stop and say &ldquo;Well, you see who&rsquo;s the winner&rdquo;. There are 5 times more people interested in RabbitMQ than HornetQ, so if you bet on Rabbit you have more chances to get the help from your fellow programmers, if you need to.</p>

<p>But before we make the final decision, I want to hear another opinion about the popularity of our candidates. Where do people go nowadays when they have software related problems? Right, they go to…</p>

<h2>StackOverflow</h2>

<p>The best thing about StackOverflow is their <a href="http://api.stackoverflow.com/1.0/usage">REST API</a>. For our purposes we need two API queries: get all <a href="http://api.stackoverflow.com/1.1/usage/methods/search">questions by a tag</a>, and get all <a href="http://api.stackoverflow.com/1.1/usage/methods/question-answers">answers</a> for the question. In fact, the second one is optional. Even the first query alone can give us most of what we want to know:</p>

<ul>
<li>how many questions have been posted for every candidate on our list?</li>
<li>how many answers did those questions receive?</li>
<li>how many answers were accepted?</li>
<li>how many questions and answers were marked useful?</li>
</ul>


<p>When we get all the numbers, we should know what people are actually using. We can also check if there is any correlation between Google data and StackOverflow.</p>

<p>So how do we proceed? We cannot use API directly to run analytics, because we would quickly exhaust the daily quota. What we can do is to fetch the data, save it locally, and run analytics against the local data. Here is another good thing about StackOverflow API: it comes in JSON format. What is the best way to analyze JSON data? Obviously, saving it in a JSON-oriented database that supports aggregated queries. And that&rsquo;s where MongoDB comes into play.</p>

<p><a href="https://gist.github.com/4276136#file-questions-py">Here</a> is the Python script that downloads all the questions for the specified tags from StackOverflow, and saves the results in the local MongoDB instance. I chose Python because I want to draw some graphs later, which is easy to do in Python. Plus, it&rsquo;s a simple and expressive language.</p>

<p>After we run this script, we get all the questions we need in our database. The next step is to get all the answers for those questions. <a href="https://gist.github.com/4276136#file-answers-py">Here</a> is the script that does exactly that.</p>

<p>Depends on how many questions we have saved on the first step, there might be quite a lot of queries to run to get all the answers. With my second script I exceeded the daily quota, so I had to wait for the next day to get the rest of the answers.</p>

<p>Now, when we have all the data, let&rsquo;s take a look how we can use it. Here is a typical StackOverflow record. I highlighted the fields that might be useful for our analysis.</p>

<pre>{
     "_id" : 269363,
     <font color="#0000FF">"accepted_answer_id"</font> : 290764,
     <font color="#0000FF">"answer_count" : 4</font>,
     "answers" : [
          ...
          {
               "view_count" : 0,
               "answer_comments_url" : "/answers/303710/comments",
               "answer_id" : 303710,
               "title" : "ActiveMQ .net client locks up",
               "community_owned" : false,
               "down_vote_count" : 0,
               "last_activity_date" : 1317300099,
               "creation_date" : 1227135282,
               "score" : 1,
               <font color="#0000FF">"up_vote_count" : 1</font>,
               "owner" : {
                    "display_name" : "HitLikeAHammer",
                    <font color="#0000FF">"reputation" : 1152</font>,
                    "user_id" : 35165,
                    "user_type" : "registered",
                    "email_hash" : "584cd9905db85f744e7e96740b11b7c0"
               },
               "accepted" : false,
               "last_edit_date" : 1317300099,
               "question_id" : 269363
          },
          ...
     ],
     "community_owned" : false,
     "creation_date" : 1225989513,
     "down_vote_count" : 0,
     "favorite_count" : 1,
     "last_activity_date" : 1317300112,
     "owner" : {
          "display_name" : "HitLikeAHammer",
          "reputation" : 1152,
          "user_id" : 35165,
          "user_type" : "registered",
          "email_hash" : "584cd9905db85f744e7e96740b11b7c0"
     },
     "question_answers_url" : "/questions/269363/answers",
     "question_comments_url" : "/questions/269363/comments",
     "question_id" : 269363,
     "question_timeline_url" : "/questions/269363/timeline",
     "score" : 1,
     <font color="#0000FF">"tags" : [
          ".net",
          "activemq"
     ]</font>,
     "title" : "ActiveMQ .net client locks up",
     <font color="#0000FF">"up_vote_count" : 1</font>,
     "view_count" : 1183
}</pre>


<p>First of all, we want to know how many questions are posted for each messaging system from our list. Here is the MongoDB query for that. The first snippet is a query, the second is the result.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Number of questions </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">db</span><span class="p">.</span><span class="nx">stackoverflow</span><span class="p">.</span><span class="nx">aggregate</span><span class="p">([</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span> <span class="p">{</span><span class="nx">$unwind</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$group</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">,</span> <span class="nx">questions</span><span class="o">:</span><span class="p">{</span><span class="nx">$sum</span><span class="o">:</span><span class="mi">1</span><span class="p">}}},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$match</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="p">{</span><span class="nx">$in</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;activemq&#39;</span><span class="p">,</span> <span class="s1">&#39;rabbitmq&#39;</span><span class="p">,</span> <span class="s1">&#39;zeromq&#39;</span><span class="p">,</span> <span class="s1">&#39;hornetq&#39;</span><span class="p">]}}},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$sort</span><span class="o">:</span><span class="p">{</span><span class="nx">questions</span><span class="o">:-</span><span class="mi">1</span><span class="p">}}</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">])[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">result</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;];</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">[</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;activemq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">1039</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;rabbitmq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">988</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;zeromq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">373</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;hornetq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">185</span>
</span><span class='line'> <span class="p">}</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>The next query is to get the total number of answers by tag</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Number of answers </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">db</span><span class="p">.</span><span class="nx">stackoverflow</span><span class="p">.</span><span class="nx">aggregate</span><span class="p">([</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span> <span class="p">{</span><span class="nx">$unwind</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$group</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">,</span> <span class="nx">answers</span><span class="o">:</span><span class="p">{</span><span class="nx">$sum</span><span class="o">:</span><span class="s1">&#39;$answer_count&#39;</span><span class="p">}}},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$match</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="p">{</span><span class="nx">$in</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;activemq&#39;</span><span class="p">,</span> <span class="s1">&#39;rabbitmq&#39;</span><span class="p">,</span> <span class="s1">&#39;zeromq&#39;</span><span class="p">,</span> <span class="s1">&#39;hornetq&#39;</span><span class="p">]}}},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$sort</span><span class="o">:</span><span class="p">{</span><span class="nx">answers</span><span class="o">:-</span><span class="mi">1</span><span class="p">}}</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">])[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">result</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;];</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">[</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;activemq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;answers&quot;</span> <span class="o">:</span> <span class="mi">1382</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;rabbitmq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;answers&quot;</span> <span class="o">:</span> <span class="mi">1322</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;zeromq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;answers&quot;</span> <span class="o">:</span> <span class="mi">572</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;hornetq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;answers&quot;</span> <span class="o">:</span> <span class="mi">227</span>
</span><span class='line'> <span class="p">}</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>It seems that the number of answers is proportional to the number of questions. With MongoDB we can quickly verify it.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Answers to questions ratio </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">db</span><span class="p">.</span><span class="nx">stackoverflow</span><span class="p">.</span><span class="nx">aggregate</span><span class="p">([</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span> <span class="p">{</span><span class="nx">$unwind</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$group</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">,</span> <span class="nx">answers</span><span class="o">:</span><span class="p">{</span><span class="nx">$sum</span><span class="o">:</span><span class="s1">&#39;$answer_count&#39;</span><span class="p">},</span> <span class="nx">questions</span><span class="o">:</span><span class="p">{</span><span class="nx">$sum</span><span class="o">:</span><span class="mi">1</span><span class="p">}}},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$match</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="p">{</span><span class="nx">$in</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;activemq&#39;</span><span class="p">,</span> <span class="s1">&#39;rabbitmq&#39;</span><span class="p">,</span> <span class="s1">&#39;zeromq&#39;</span><span class="p">,</span> <span class="s1">&#39;hornetq&#39;</span><span class="p">]}}},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$project</span><span class="o">:</span><span class="p">{</span><span class="nx">answers</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">questions</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">ratio</span><span class="o">:</span><span class="p">{</span><span class="nx">$divide</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;$answers&#39;</span><span class="p">,</span> <span class="s1">&#39;$questions&#39;</span><span class="p">]}}},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$sort</span><span class="o">:</span><span class="p">{</span><span class="nx">ratio</span><span class="o">:-</span><span class="mi">1</span><span class="p">}}</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">])[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">result</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;];</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">[</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;zeromq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;answers&quot;</span> <span class="o">:</span> <span class="mi">572</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">373</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;ratio&quot;</span> <span class="o">:</span> <span class="mf">1.5335120643431635</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;rabbitmq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;answers&quot;</span> <span class="o">:</span> <span class="mi">1322</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">988</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;ratio&quot;</span> <span class="o">:</span> <span class="mf">1.3380566801619433</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;activemq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;answers&quot;</span> <span class="o">:</span> <span class="mi">1382</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">1039</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;ratio&quot;</span> <span class="o">:</span> <span class="mf">1.3301251203079885</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;hornetq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;answers&quot;</span> <span class="o">:</span> <span class="mi">227</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">185</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;ratio&quot;</span> <span class="o">:</span> <span class="mf">1.227027027027027</span>
</span><span class='line'> <span class="p">}</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Indeed, the answers/question ratio is almost the same for every tag. That means we can use just the number of questions for our analysis.</p>

<p>Here is the query that calculates the number of <em>accepted</em> answers by tag. Again, it correlates fairly well with the total number of answers and questions.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Number of accepted answers </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">db</span><span class="p">.</span><span class="nx">stackoverflow</span><span class="p">.</span><span class="nx">aggregate</span><span class="p">([</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span> <span class="p">{</span><span class="nx">$match</span><span class="o">:</span><span class="p">{</span><span class="nx">accepted_answer_id</span><span class="o">:</span><span class="p">{</span><span class="nx">$ne</span><span class="o">:</span><span class="kc">null</span><span class="p">}}},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$unwind</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$group</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">,</span> <span class="nx">accepted_answers</span><span class="o">:</span><span class="p">{</span><span class="nx">$sum</span><span class="o">:</span><span class="mi">1</span><span class="p">}}},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$match</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="p">{</span><span class="nx">$in</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;activemq&#39;</span><span class="p">,</span> <span class="s1">&#39;rabbitmq&#39;</span><span class="p">,</span> <span class="s1">&#39;zeromq&#39;</span><span class="p">,</span> <span class="s1">&#39;hornetq&#39;</span><span class="p">]}}},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$sort</span><span class="o">:</span><span class="p">{</span><span class="nx">accepted_answers</span><span class="o">:-</span><span class="mi">1</span><span class="p">}}</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">])[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">result</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;];</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">[</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;activemq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;accepted_answers&quot;</span> <span class="o">:</span> <span class="mi">531</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;rabbitmq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;accepted_answers&quot;</span> <span class="o">:</span> <span class="mi">500</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;zeromq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;accepted_answers&quot;</span> <span class="o">:</span> <span class="mi">221</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;hornetq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;accepted_answers&quot;</span> <span class="o">:</span> <span class="mi">94</span>
</span><span class='line'> <span class="p">}</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>The next query is more interesting. It calculates the number of question up-votes by tag. In other words, it shows the number of <em>useful</em> questions. If we divide it by the total number of questions, we should see which messaging system has bigger rate of useful questions than others</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Number of useful questions </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">db</span><span class="p">.</span><span class="nx">stackoverflow</span><span class="p">.</span><span class="nx">aggregate</span><span class="p">([</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span> <span class="p">{</span><span class="nx">$unwind</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$group</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">,</span> <span class="nx">upvotes</span><span class="o">:</span><span class="p">{</span><span class="nx">$sum</span><span class="o">:</span><span class="s1">&#39;$up_vote_count&#39;</span><span class="p">},</span> <span class="nx">questions</span><span class="o">:</span><span class="p">{</span><span class="nx">$sum</span><span class="o">:</span><span class="mi">1</span><span class="p">}}},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$match</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="p">{</span><span class="nx">$in</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;activemq&#39;</span><span class="p">,</span> <span class="s1">&#39;rabbitmq&#39;</span><span class="p">,</span> <span class="s1">&#39;zeromq&#39;</span><span class="p">,</span> <span class="s1">&#39;hornetq&#39;</span><span class="p">]}}},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$project</span><span class="o">:</span><span class="p">{</span><span class="nx">upvotes</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">questions</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">ratio</span><span class="o">:</span><span class="p">{</span><span class="nx">$divide</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;$upvotes&#39;</span><span class="p">,</span> <span class="s1">&#39;$questions&#39;</span><span class="p">]}}},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$sort</span><span class="o">:</span><span class="p">{</span><span class="nx">ratio</span><span class="o">:-</span><span class="mi">1</span><span class="p">}}</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">])[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">result</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;];</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">[</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;zeromq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;upvotes&quot;</span> <span class="o">:</span> <span class="mi">1078</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">373</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;ratio&quot;</span> <span class="o">:</span> <span class="mf">2.8900804289544237</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;rabbitmq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;upvotes&quot;</span> <span class="o">:</span> <span class="mi">1864</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">988</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;ratio&quot;</span> <span class="o">:</span> <span class="mf">1.8866396761133604</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;activemq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;upvotes&quot;</span> <span class="o">:</span> <span class="mi">1459</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">1039</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;ratio&quot;</span> <span class="o">:</span> <span class="mf">1.4042348411934553</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;hornetq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;upvotes&quot;</span> <span class="o">:</span> <span class="mi">233</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">185</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;ratio&quot;</span> <span class="o">:</span> <span class="mf">1.2594594594594595</span>
</span><span class='line'> <span class="p">}</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Interesting. The ZeroMQ users seem to ask more useful questions than the users of other brokers.</p>

<p>Let&rsquo;s do the same analysis for the answers. Here is the query that calculates the number of answer up-votes by tag.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Number of useful answers </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">db</span><span class="p">.</span><span class="nx">stackoverflow</span><span class="p">.</span><span class="nx">aggregate</span><span class="p">([</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span> <span class="p">{</span><span class="nx">$unwind</span><span class="o">:</span><span class="s1">&#39;$answers&#39;</span><span class="p">},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$unwind</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$group</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="p">{</span><span class="nx">question</span><span class="o">:</span><span class="s1">&#39;$_id&#39;</span><span class="p">,</span> <span class="nx">tag</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">},</span> <span class="nx">upvotes</span><span class="o">:</span><span class="p">{</span><span class="nx">$sum</span><span class="o">:</span><span class="s1">&#39;$answers.up_vote_count&#39;</span><span class="p">}}},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$group</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="s1">&#39;$_id.tag&#39;</span><span class="p">,</span> <span class="nx">upvotes</span><span class="o">:</span><span class="p">{</span><span class="nx">$sum</span><span class="o">:</span><span class="s1">&#39;$upvotes&#39;</span><span class="p">},</span> <span class="nx">questions</span><span class="o">:</span><span class="p">{</span><span class="nx">$sum</span><span class="o">:</span><span class="mi">1</span><span class="p">}}},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$match</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="p">{</span><span class="nx">$in</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;activemq&#39;</span><span class="p">,</span> <span class="s1">&#39;rabbitmq&#39;</span><span class="p">,</span> <span class="s1">&#39;zeromq&#39;</span><span class="p">,</span> <span class="s1">&#39;hornetq&#39;</span><span class="p">]}}},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$project</span><span class="o">:</span><span class="p">{</span><span class="nx">upvotes</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">questions</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">ratio</span><span class="o">:</span><span class="p">{</span><span class="nx">$divide</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;$upvotes&#39;</span><span class="p">,</span> <span class="s1">&#39;$questions&#39;</span><span class="p">]}}},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$sort</span><span class="o">:</span><span class="p">{</span><span class="nx">ratio</span><span class="o">:-</span><span class="mi">1</span><span class="p">}}</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">])[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">result</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;];</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">[</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;zeromq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;upvotes&quot;</span> <span class="o">:</span> <span class="mi">1469</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">338</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;ratio&quot;</span> <span class="o">:</span> <span class="mf">4.346153846153846</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;rabbitmq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;upvotes&quot;</span> <span class="o">:</span> <span class="mi">2437</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">858</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;ratio&quot;</span> <span class="o">:</span> <span class="mf">2.84032634032634</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;activemq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;upvotes&quot;</span> <span class="o">:</span> <span class="mi">2199</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">902</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;ratio&quot;</span> <span class="o">:</span> <span class="mf">2.4379157427937916</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;hornetq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;upvotes&quot;</span> <span class="o">:</span> <span class="mi">262</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;questions&quot;</span> <span class="o">:</span> <span class="mi">156</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;ratio&quot;</span> <span class="o">:</span> <span class="mf">1.6794871794871795</span>
</span><span class='line'> <span class="p">}</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Again, ZeroMQ users post more useful answers than others.</p>

<p>To complete the picture of typical users, let&rsquo;s run the following query that calculates an average reputation of people that post answers</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Reputation of respondents </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">db</span><span class="p">.</span><span class="nx">stackoverflow</span><span class="p">.</span><span class="nx">aggregate</span><span class="p">([</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span> <span class="p">{</span><span class="nx">$unwind</span><span class="o">:</span><span class="s1">&#39;$answers&#39;</span><span class="p">},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$unwind</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$group</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="p">{</span><span class="nx">question</span><span class="o">:</span><span class="s1">&#39;$_id&#39;</span><span class="p">,</span> <span class="nx">tag</span><span class="o">:</span><span class="s1">&#39;$tags&#39;</span><span class="p">},</span> <span class="nx">reputation</span><span class="o">:</span><span class="p">{</span><span class="nx">$avg</span><span class="o">:</span><span class="s1">&#39;$answers.owner.reputation&#39;</span><span class="p">}}},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$group</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="s1">&#39;$_id.tag&#39;</span><span class="p">,</span> <span class="nx">reputation</span><span class="o">:</span><span class="p">{</span><span class="nx">$avg</span><span class="o">:</span><span class="s1">&#39;$reputation&#39;</span><span class="p">}}},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$match</span><span class="o">:</span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="p">{</span><span class="nx">$in</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;activemq&#39;</span><span class="p">,</span> <span class="s1">&#39;rabbitmq&#39;</span><span class="p">,</span> <span class="s1">&#39;zeromq&#39;</span><span class="p">,</span> <span class="s1">&#39;hornetq&#39;</span><span class="p">]}}},</span>
</span><span class='line'> <span class="p">{</span><span class="nx">$sort</span><span class="o">:</span><span class="p">{</span><span class="nx">reputation</span><span class="o">:-</span><span class="mi">1</span><span class="p">}}</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">])[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">result</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;];</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">[</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;zeromq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;reputation&quot;</span> <span class="o">:</span> <span class="mf">10088.29552338687</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;activemq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;reputation&quot;</span> <span class="o">:</span> <span class="mf">7298.7539383380845</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;rabbitmq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;reputation&quot;</span> <span class="o">:</span> <span class="mf">6082.172231934734</span>
</span><span class='line'> <span class="p">},</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;_id&quot;</span> <span class="o">:</span> <span class="s2">&quot;hornetq&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;reputation&quot;</span> <span class="o">:</span> <span class="mf">3472.9658119658116</span>
</span><span class='line'> <span class="p">}</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Wow. ZeroMQ users not only ask more useful questions and give useful answers, they also have higher reputation on average in the StackOverflow community.</p>

<p>As a final exercise, I want to build a graph of question distribution over time. After all, ActiveMQ is the oldest broker, and it might have got more questions just because it was launched first. For this purpose I created <a href="https://gist.github.com/4276136#file-trends-py">this</a> Python script that uses amazing <a href="http://matplotlib.org/gallery.html">matplotlib</a> library. And here is the result for the last 60 months</p>

<p><img class="center" src="/images/posts/mom-trends-so.png"></p>

<p>It shows that the proportion of interest in different massaging systems was approximately the same all the time. Furthermore, the StackOverflow statistics of this year correlates well with the Google statistics.</p>

<h2>Conclusion</h2>

<ol>
<li><p>RabbitMQ and ActiveMQ are very popular. If you choose one of them for your messaging infrastructure, you shouldn&rsquo;t have any problem with the community support. HornetQ might be a good message broker but it definitely lacks the community interest. Finally, as I <a href="/2012/11/12/pycon-canada-2012/#learn">suspected</a> before, ZeroMQ is worth looking at. There are bunch of smart and helpful people in ZeroMQ community.</p></li>
<li><p>MongoDB is really nice! Its aggregation framework is powerful and easy to use. It was fun playing with it.</p></li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Integrating RabbitMQ with ejabberd]]></title>
    <link href="http://blog.ndpar.com/2010/03/31/integrating-rabbitmq-with-ejabberd/"/>
    <updated>2010-03-31T08:00:00-04:00</updated>
    <id>http://blog.ndpar.com/2010/03/31/integrating-rabbitmq-with-ejabberd</id>
    <content type="html"><![CDATA[<p>ejabberd is integrated with RabbitMQ by means of <a href="http://tonyg.github.io/rabbitmq-xmpp/">mod_rabbitmq</a> gateway. If you followed my ejabberd installation <a href="/2010/02/23/get-started-with-ejabberd/">instructions</a>, you should already have mod_rabbitmq installed.</p>

<h2>Configure mod_rabbitmq</h2>

<p>Open <em>/opt/ejabberd/ejabberd/etc/ejabberd/ejabberd.cfg</em> file, find <em>modules</em> section, and add mod_rabbitmq stanza to the list</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>/opt/ejabberd/ejabberd/etc/ejabberd/ejabberd.cfg </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="p">{</span><span class="n">modules</span><span class="p">,</span>
</span><span class='line'> <span class="p">[</span>
</span><span class='line'>  <span class="err">&amp;</span><span class="n">hellip</span><span class="p">;</span>
</span><span class='line'>  <span class="p">{</span><span class="n">mod_rabbitmq</span><span class="p">,</span>  <span class="p">[{</span><span class="n">rabbitmq_node</span><span class="p">,</span> <span class="nv">RABBIT_NODE</span><span class="p">}]},</span>
</span><span class='line'>  <span class="err">&amp;</span><span class="n">hellip</span><span class="p">;</span>
</span><span class='line'> <span class="p">]}.</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>You need to replace <em>RABBIT_NODE</em> with the real value, which you can find from the RabbitMQ process information</p>

<pre><code>$ ps -ef | grep beam
rabbitmq  8525  8142  0 16:37 pts/0    ... -sname rabbit@ubuntu ...
</code></pre>

<p>You can see my RabbitMQ node name is <em>rabbit@ubuntu</em>.</p>

<h2>Set up cookie</h2>

<p>To make RabbitMQ and ejabberd work together, they have to run in the same Erlang cluster. That means they have to use the same cookie file. If you <a href="/2010/03/14/get-started-with-rabbitmq/">installed</a> RabbitMQ from binary distribution, it uses the user&rsquo;s cookie <em>~/.erlang.cookie</em>. ejabberd, on the other hand, uses its own cookie. Let&rsquo;s replace it with the user&rsquo;s</p>

<pre><code>$ cd /opt/ejabberd/ejabberd/var/lib/ejabberd
$ rm -f .erlang.cookie
$ ln -s ~/.erlang.cookie
</code></pre>

<p>Restart ejabberd server</p>

<pre><code>$ /opt/ejabberd/ejabberd/sbin/ejabberdctl restart
</code></pre>

<h2>Add rabbit buddy to roster</h2>

<p>The rabbit&rsquo;s JID consists of two parts: exchange name and routing domain. The routing domain is a string <code>rabbitmq.EJABBERD_HOST</code> where <em>EJABBERD_HOST</em> is the host you registered in <em>ejabberd.cfg</em>. In my case the routing domain is <code>rabbitmq.jabber.ndpar.com</code>.</p>

<p>For the name you can use any exchange name available in the RabbitMQ server. I use <code>amq.fanout</code> exchange which exists in every RabbitMQ server. So I go to my IM client (Adium) and add this user to the buddies list <code>amq.fanout@rabbitmq.jabber.ndpar.com</code>.</p>

<h2>Rabbit&rsquo;s greetings</h2>

<p>To publish a message to RabbitMQ I use the same Groovy script as in the previous <a href="/2010/03/14/get-started-with-rabbitmq/">post</a></p>

<pre><code>$ ./publisher.groovy
</code></pre>

<p><img class="center" src="/images/posts/mod_rabbitmq.png"></p>

<h3>Resources</h3>

<ul>
<li>Tony Garnock-Jones' <a href="http://www.erlang-factory.com/upload/presentations/229/ErlangFactorySFBay2010-TonyGarnock-Jones.pdf">presentation slides</a> about RabbitMQ and its extensions.</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Get started with RabbitMQ]]></title>
    <link href="http://blog.ndpar.com/2010/03/14/get-started-with-rabbitmq/"/>
    <updated>2010-03-14T08:00:00-04:00</updated>
    <id>http://blog.ndpar.com/2010/03/14/get-started-with-rabbitmq</id>
    <content type="html"><![CDATA[<p><a href="http://www.rabbitmq.com">RabbitMQ</a> is an open-source implementation of <a href="http://en.wikipedia.org/wiki/AMQP">AMQP</a>. If you don&rsquo;t know what AMQP is, I encourage you to read about it on the official web site or the reference <a href="http://www.rabbitmq.com/how.html">page</a>. What <em>I</em> personally like in RabbitMQ/AMQP is</p>

<ul>
<li>AMQP is a free alternative to expensive TIBCO Randezvous.</li>
<li>Functionality-wise AMQP is a superset of JMS.</li>
<li>RabbitMQ is written in Erlang, which means fault-tolerance and reliability.</li>
</ul>


<p>In this short blog entry I show how to install RabbitMQ on a *nix box, and verify that it&rsquo;s working with a simple Groovy client.</p>

<!-- more -->


<h2>Installing RabbitMQ server</h2>

<p>Before installing RabbitMQ make sure you have Erlang environment set up. Run the following command and verify the output</p>

<pre><code>$ erl -version
Erlang (ASYNC_THREADS,HIPE) (BEAM) emulator version 5.10.1
</code></pre>

<p>I used to install RabbitMQ using apt-get command, which is convenient but always several versions behind. That&rsquo;s why I switched to <a href="http://www.rabbitmq.com/install-generic-unix.html">binary distribution</a> installation. So here are the installation steps</p>

<pre><code>$ sudo mkdir /opt/rabbitmq
$ sudo chown -R rabbitmq /opt/rabbitmq
$ cd /opt/rabbitmq
$ wget http://www.rabbitmq.com/releases/rabbitmq-server/v3.1.1/rabbitmq-server-generic-unix-3.1.1.tar.gz
$ tar xf rabbitmq-server-generic-unix-3.1.1.tar.gz
$ rm rabbitmq-server-generic-unix-3.1.1.tar.gz
$ ln -s rabbitmq_server-3.1.1 rabbitmq
</code></pre>

<p>Append the following lines to <em>~/.bashrc</em></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>~/.bashrc </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">RABBITMQ_HOME</span><span class="o">=</span>/opt/rabbitmq/rabbitmq
</span><span class='line'><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="nv">$RABBITMQ_HOME</span>/sbin
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Enable web admin plugin</p>

<pre><code>$ rabbitmq-plugins enable rabbitmq_management
</code></pre>

<p>Run the following command to verify server is starting</p>

<pre><code>$ rabbitmq-server

              RabbitMQ 3.1.1. Copyright (C) 2007-2013 VMware, Inc.
  ##  ##      Licensed under the MPL.  See http://www.rabbitmq.com/
  ##  ##
  ##########  Logs: /opt/rabbitmq/rabbitmq/sbin/../var/log/rabbitmq/rabbit@beta.log
  ######  ##        /opt/rabbitmq/rabbitmq/sbin/../var/log/rabbitmq/rabbit@beta-sasl.log
  ##########
              Starting broker... completed with 6 plugins.
</code></pre>

<p>Go to <a href="http://localhost:15672">localhost:15672</a> in the browser. You should be able to login as guest/guest.</p>

<h2>Groovy client</h2>

<p>Groovy client is essentially Java client written in Groovy language. Here are the scripts for consumer and publisher in Groovy</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>consumer.groovy </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="o">&lt;</span><span class="s">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="s">&lt;h1&gt;!/</span><span class="n">usr</span><span class="s">/bin/</span><span class="n">env</span> <span class="n">groovy</span><span class="o">&lt;</span><span class="s">/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="s">&lt;p&gt;import com.rabbitmq.client.*&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="nd">@Grab</span><span class="o">(</span><span class="n">group</span><span class="o">=&amp;</span><span class="n">lsquo</span><span class="o">;</span><span class="n">com</span><span class="o">.</span><span class="na">rabbitmq</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="o">;,</span> <span class="n">module</span><span class="o">=&amp;</span><span class="n">lsquo</span><span class="o">;</span><span class="n">amqp</span><span class="o">-</span><span class="n">client</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="o">;,</span> <span class="n">version</span><span class="o">=&amp;</span><span class="n">lsquo</span><span class="o">;</span><span class="mf">3.1</span><span class="o">.</span><span class="mi">0</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="o">;)</span>
</span><span class='line'><span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConnectionFactory</span><span class="o">([&lt;</span><span class="s">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="s">&lt;pre&gt;&lt;code&gt;username: &#39;guest&#39;,</span>
</span><span class='line'><span class="s">password: &#39;guest&#39;,</span>
</span><span class='line'><span class="s">virtualHost: &#39;/</span><span class="err">&#39;</span><span class="o">,</span>
</span><span class='line'><span class="nl">requestedHeartbeat:</span> <span class="mi">0</span>
</span><span class='line'><span class="o">&lt;</span><span class="s">/code&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;])</span>
</span><span class='line'><span class="n">conn</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">newConnection</span><span class="o">(</span><span class="k">new</span> <span class="n">Address</span><span class="o">(&amp;</span><span class="n">lsquo</span><span class="o">;</span><span class="n">localhost</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="o">;,</span> <span class="mi">5672</span><span class="o">))</span>
</span><span class='line'><span class="n">channel</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">createChannel</span><span class="o">()&lt;</span><span class="s">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="s">&lt;p&gt;queueName = &amp;lsquo;myQueue&amp;rsquo;&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">channel</span><span class="o">.</span><span class="na">queueDeclare</span> <span class="n">queueName</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="o">[:]</span>
</span><span class='line'><span class="n">channel</span><span class="o">.</span><span class="na">queueBind</span> <span class="n">queueName</span><span class="o">,</span> <span class="o">&amp;</span><span class="n">lsquo</span><span class="o">;</span><span class="n">amq</span><span class="o">.</span><span class="na">fanout</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="o">;,</span> <span class="o">&amp;</span><span class="n">lsquo</span><span class="o">;</span><span class="n">myRoutingKey</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="o">;&lt;</span><span class="s">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="s">&lt;p&gt;def consumer = new QueueingConsumer(channel)</span>
</span><span class='line'><span class="s">channel.basicConsume queueName, false, consumer&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{&lt;</span><span class="s">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="s">&lt;pre&gt;&lt;code&gt;delivery = consumer.nextDelivery()</span>
</span><span class='line'><span class="s">println &quot;Received message: ${new String(delivery.body)}&quot;</span>
</span><span class='line'><span class="s">channel.basicAck delivery.envelope.deliveryTag, false</span>
</span><span class='line'><span class="s">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;}</span>
</span><span class='line'><span class="n">channel</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>
</span><span class='line'><span class="n">conn</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>publisher.groovy </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="o">&lt;</span><span class="s">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="s">&lt;h1&gt;!/</span><span class="n">usr</span><span class="s">/bin/</span><span class="n">env</span> <span class="n">groovy</span><span class="o">&lt;</span><span class="s">/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="s">&lt;p&gt;import com.rabbitmq.client.*&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="nd">@Grab</span><span class="o">(</span><span class="n">group</span><span class="o">=&amp;</span><span class="n">lsquo</span><span class="o">;</span><span class="n">com</span><span class="o">.</span><span class="na">rabbitmq</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="o">;,</span> <span class="n">module</span><span class="o">=&amp;</span><span class="n">lsquo</span><span class="o">;</span><span class="n">amqp</span><span class="o">-</span><span class="n">client</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="o">;,</span> <span class="n">version</span><span class="o">=&amp;</span><span class="n">lsquo</span><span class="o">;</span><span class="mf">3.1</span><span class="o">.</span><span class="mi">0</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="o">;)</span>
</span><span class='line'><span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConnectionFactory</span><span class="o">([&lt;</span><span class="s">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="s">&lt;pre&gt;&lt;code&gt;username: &#39;guest&#39;,</span>
</span><span class='line'><span class="s">password: &#39;guest&#39;,</span>
</span><span class='line'><span class="s">virtualHost: &#39;/</span><span class="err">&#39;</span><span class="o">,</span>
</span><span class='line'><span class="nl">requestedHeartbeat:</span> <span class="mi">0</span>
</span><span class='line'><span class="o">&lt;</span><span class="s">/code&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;])</span>
</span><span class='line'><span class="n">conn</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">newConnection</span><span class="o">(</span><span class="k">new</span> <span class="n">Address</span><span class="o">(&amp;</span><span class="n">lsquo</span><span class="o">;</span><span class="n">localhost</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="o">;,</span> <span class="mi">5672</span><span class="o">))</span>
</span><span class='line'><span class="n">channel</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">createChannel</span><span class="o">()&lt;</span><span class="s">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="s">&lt;p&gt;channel.basicPublish &amp;lsquo;amq.fanout&amp;rsquo;, &amp;lsquo;myRoutingKey&amp;rsquo;, null, &amp;ldquo;Hello, world!&amp;rdquo;.bytes&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">channel</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>
</span><span class='line'><span class="n">conn</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Run consumer script in one terminal window</p>

<pre><code>$ chmod 755 consumer.groovy
$ ./consumer.groovy
</code></pre>

<p>and publisher script in another</p>

<pre><code>$ chmod 755 publisher.groovy
$ ./publisher.groovy
</code></pre>

<p>On the consumer window you should see <em>Received message: Hello, world!</em> text.</p>

<p>Now you just need to stop RabbitMQ server, and restart it in detached mode</p>

<pre><code>$ sudo -u rabbitmq rabbitmq-server -detached
</code></pre>
]]></content>
  </entry>
  
</feed>
